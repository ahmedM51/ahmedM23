<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>المساعد الذكي - منصة الطالب الذكي</title>
    <meta name="description" content="مساعد ذكي يستخدم الذكاء الاصطناعي لمساعدة الطلاب في التعلم والمذاكرة">
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@300;400;600;700&display=swap" rel="stylesheet">
    
    <style>
        body { 
            font-family: 'Cairo', sans-serif; 
            direction: rtl;
            background: #f8fafc;
        }
        
        .chat-container {
            height: 70vh;
            overflow-y: auto;
            scroll-behavior: smooth;
        }
        
        .message {
            margin-bottom: 16px;
            animation: fadeIn 0.3s ease-in;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .user-message {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 12px 16px;
            border-radius: 18px 18px 4px 18px;
            margin-left: 20%;
            box-shadow: 0 2px 8px rgba(102, 126, 234, 0.3);
        }
        
        .ai-message {
            background: white;
            color: #2d3748;
            padding: 12px 16px;
            border-radius: 18px 18px 18px 4px;
            margin-right: 20%;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            border-left: 4px solid #667eea;
        }
        
        .typing-indicator {
            display: none;
            background: white;
            padding: 16px;
            border-radius: 18px 18px 18px 4px;
            margin-right: 20%;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }
        
        .typing-dots {
            display: flex;
            gap: 4px;
        }
        
        .typing-dot {
            width: 8px;
            height: 8px;
            background: #667eea;
            border-radius: 50%;
            animation: typing 1.4s infinite;
        }
        
        .typing-dot:nth-child(2) { animation-delay: 0.2s; }
        .typing-dot:nth-child(3) { animation-delay: 0.4s; }
        
        @keyframes typing {
            0%, 60%, 100% { transform: translateY(0); }
            30% { transform: translateY(-10px); }
        }
        
        .input-container {
            background: white;
            border-radius: 25px;
            padding: 8px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            border: 2px solid #e2e8f0;
            transition: border-color 0.3s ease;
        }
        
        .input-container:focus-within {
            border-color: #667eea;
        }
        
        .message-input {
            border: none;
            outline: none;
            padding: 12px 16px;
            font-size: 16px;
            flex: 1;
            background: transparent;
        }
        
        .send-button {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 50%;
            width: 44px;
            height: 44px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .send-button:hover {
            transform: scale(1.05);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
        }
        
        .send-button:disabled {
            background: #cbd5e0;
            cursor: not-allowed;
            transform: none;
        }
        
        .quick-questions {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-bottom: 16px;
        }
        
        .quick-question {
            background: white;
            border: 2px solid #e2e8f0;
            padding: 8px 16px;
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 14px;
        }
        
        .quick-question:hover {
            border-color: #667eea;
            background: #f7fafc;
        }
        
        .welcome-message {
            text-align: center;
            padding: 40px 20px;
            color: #4a5568;
        }
        
        .ai-avatar {
            width: 40px;
            height: 40px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            margin-bottom: 8px;
        }
    </style>
</head>
<body class="min-h-screen bg-gray-50">
    <!-- Header -->
    <header class="bg-gradient-to-r from-purple-600 to-blue-600 text-white shadow-lg">
        <div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center h-16">
                <div class="flex items-center space-x-4 space-x-reverse">
                    <div class="bg-white bg-opacity-20 p-2 rounded-lg">
                        <i class="fas fa-robot text-xl"></i>
                    </div>
                    <div>
                        <h1 class="text-xl font-bold">المساعد الذكي</h1>
                        <p class="text-purple-100 text-sm">مساعدك الشخصي في التعلم</p>
                    </div>
                </div>
                <div class="flex items-center space-x-4 space-x-reverse">
                    <button onclick="clearChat()" class="bg-white bg-opacity-20 hover:bg-opacity-30 px-4 py-2 rounded-lg text-sm transition-colors">
                        <i class="fas fa-trash ml-1"></i>مسح المحادثة
                    </button>
                    <a href="index.html" class="bg-white bg-opacity-20 hover:bg-opacity-30 px-4 py-2 rounded-lg text-sm transition-colors">
                        <i class="fas fa-home ml-1"></i>الرئيسية
                    </a>
                </div>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
        <div class="bg-white rounded-xl shadow-lg overflow-hidden">
            <!-- Chat Container -->
            <div id="chatContainer" class="chat-container p-6">
                <!-- Welcome Message -->
                <div id="welcomeMessage" class="welcome-message">
                    <div class="ai-avatar mx-auto mb-4">
                        <i class="fas fa-robot text-xl"></i>
                    </div>
                    <h2 class="text-2xl font-bold text-gray-800 mb-2">مرحباً بك في المساعد الذكي!</h2>
                    <p class="text-gray-600 mb-6">أنا هنا لمساعدتك في التعلم والإجابة على أسئلتك. اسأل عن أي موضوع تريد!</p>
                    
                    <!-- Quick Questions -->
                    <div class="quick-questions justify-center">
                        <button class="quick-question" onclick="askQuestion('شرح لي مفهوم الذكاء الاصطناعي')">
                            ما هو الذكاء الاصطناعي؟
                        </button>
                        <button class="quick-question" onclick="askQuestion('كيف أحسن من مهاراتي في الرياضيات؟')">
                            تحسين مهارات الرياضيات
                        </button>
                        <button class="quick-question" onclick="askQuestion('أعطني نصائح للمذاكرة الفعالة')">
                            نصائح للمذاكرة
                        </button>
                        <button class="quick-question" onclick="askQuestion('كيف أنظم وقتي للدراسة؟')">
                            تنظيم الوقت
                        </button>
                    </div>
                </div>
                
                <!-- Messages will be added here -->
                <div id="messagesContainer"></div>
                
                <!-- Typing Indicator -->
                <div id="typingIndicator" class="typing-indicator">
                    <div class="flex items-center space-x-2 space-x-reverse">
                        <div class="ai-avatar" style="width: 24px; height: 24px; font-size: 12px;">
                            <i class="fas fa-robot"></i>
                        </div>
                        <div class="typing-dots">
                            <div class="typing-dot"></div>
                            <div class="typing-dot"></div>
                            <div class="typing-dot"></div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Input Area -->
            <div class="p-6 bg-gray-50 border-t">
                <div class="input-container flex items-center">
                    <input 
                        type="text" 
                        id="messageInput" 
                        class="message-input" 
                        placeholder="اكتب سؤالك هنا..."
                        onkeypress="handleKeyPress(event)"
                    >
                    <button 
                        id="sendButton" 
                        class="send-button" 
                        onclick="sendMessage()"
                    >
                        <i class="fas fa-paper-plane"></i>
                    </button>
                </div>
                <div class="text-xs text-gray-500 text-center mt-2">
                    اضغط Enter للإرسال • المساعد مدعوم بالذكاء الاصطناعي
                </div>
            </div>
        </div>
    </div>

    <script>
        let isWaitingForResponse = false;
        let messageHistory = [];

        // Initialize page
        document.addEventListener('DOMContentLoaded', function() {
            console.log('🤖 AI Assistant initialized');
            loadChatHistory();
        });

        // Handle key press
        function handleKeyPress(event) {
            if (event.key === 'Enter' && !event.shiftKey) {
                event.preventDefault();
                sendMessage();
            }
        }

        // Send message
        async function sendMessage() {
            const input = document.getElementById('messageInput');
            const message = input.value.trim();
            
            if (!message || isWaitingForResponse) return;
            
            // Add user message
            addMessage(message, 'user');
            input.value = '';
            
            // Hide welcome message
            hideWelcomeMessage();
            
            // Show typing indicator
            showTypingIndicator();
            
            // Get AI response
            await getAIResponse(message);
        }

        // Ask predefined question
        function askQuestion(question) {
            document.getElementById('messageInput').value = question;
            sendMessage();
        }

        // Add message to chat
        function addMessage(content, sender) {
            const messagesContainer = document.getElementById('messagesContainer');
            const messageDiv = document.createElement('div');
            messageDiv.className = 'message';
            
            if (sender === 'user') {
                messageDiv.innerHTML = `
                    <div class="user-message">
                        ${content}
                    </div>
                `;
            } else {
                messageDiv.innerHTML = `
                    <div class="flex items-start space-x-2 space-x-reverse">
                        <div class="ai-avatar" style="width: 32px; height: 32px; font-size: 14px; margin-top: 4px;">
                            <i class="fas fa-robot"></i>
                        </div>
                        <div class="ai-message flex-1">
                            ${content}
                        </div>
                    </div>
                `;
            }
            
            messagesContainer.appendChild(messageDiv);
            scrollToBottom();
            
            // Save to history
            messageHistory.push({ content, sender, timestamp: new Date().toISOString() });
            saveChatHistory();
        }

        // Get AI response
        async function getAIResponse(userMessage) {
            isWaitingForResponse = true;
            updateSendButton();
            
            try {
                // Simulate API call - Replace with actual AI API
                await new Promise(resolve => setTimeout(resolve, 1000 + Math.random() * 2000));
                
                const response = generateAIResponse(userMessage);
                hideTypingIndicator();
                addMessage(response, 'ai');
                
            } catch (error) {
                console.error('AI Response Error:', error);
                hideTypingIndicator();
                addMessage('عذراً، حدث خطأ في الحصول على الرد. يرجى المحاولة مرة أخرى.', 'ai');
            } finally {
                isWaitingForResponse = false;
                updateSendButton();
            }
        }

        // Generate AI response (placeholder)
        function generateAIResponse(userMessage) {
            const responses = {
                'ذكاء اصطناعي': 'الذكاء الاصطناعي هو مجال في علوم الحاسوب يهدف إلى إنشاء أنظمة قادرة على أداء مهام تتطلب ذكاءً بشرياً، مثل التعلم والاستنتاج وحل المشكلات.',
                'رياضيات': 'لتحسين مهاراتك في الرياضيات: 1) مارس بانتظام، 2) ابدأ بالأساسيات، 3) حل مسائل متنوعة، 4) اطلب المساعدة عند الحاجة، 5) استخدم التطبيقات التعليمية.',
                'مذاكرة': 'نصائح للمذاكرة الفعالة: 1) اختر مكاناً هادئاً، 2) قسم المادة لأجزاء صغيرة، 3) استخدم تقنية البومودورو، 4) اكتب ملاحظات، 5) راجع بانتظام.',
                'وقت': 'لتنظيم وقت الدراسة: 1) ضع جدولاً زمنياً، 2) حدد أولوياتك، 3) خصص وقتاً للراحة، 4) تجنب المشتتات، 5) كن مرناً في التعديل.'
            };
            
            // Find matching response
            for (const [key, response] of Object.entries(responses)) {
                if (userMessage.includes(key)) {
                    return response;
                }
            }
            
            // Default responses
            const defaultResponses = [
                'هذا سؤال ممتاز! دعني أفكر في أفضل طريقة للإجابة عليه.',
                'أفهم ما تسأل عنه. هذا موضوع مهم في التعلم.',
                'سؤال جيد! يمكنني مساعدتك في فهم هذا الموضوع بشكل أفضل.',
                'شكراً لسؤالك. هذا يظهر اهتمامك بالتعلم والتطوير.'
            ];
            
            return defaultResponses[Math.floor(Math.random() * defaultResponses.length)];
        }

        // UI Helper Functions
        function hideWelcomeMessage() {
            const welcomeMessage = document.getElementById('welcomeMessage');
            if (welcomeMessage) {
                welcomeMessage.style.display = 'none';
            }
        }

        function showTypingIndicator() {
            document.getElementById('typingIndicator').style.display = 'block';
            scrollToBottom();
        }

        function hideTypingIndicator() {
            document.getElementById('typingIndicator').style.display = 'none';
        }

        function updateSendButton() {
            const sendButton = document.getElementById('sendButton');
            sendButton.disabled = isWaitingForResponse;
        }

        function scrollToBottom() {
            const chatContainer = document.getElementById('chatContainer');
            setTimeout(() => {
                chatContainer.scrollTop = chatContainer.scrollHeight;
            }, 100);
        }

        function clearChat() {
            if (confirm('هل تريد مسح جميع المحادثات؟')) {
                document.getElementById('messagesContainer').innerHTML = '';
                document.getElementById('welcomeMessage').style.display = 'block';
                messageHistory = [];
                saveChatHistory();
            }
        }

        // Chat History Management
        function saveChatHistory() {
            try {
                localStorage.setItem('aiChatHistory', JSON.stringify(messageHistory));
            } catch (error) {
                console.error('Error saving chat history:', error);
            }
        }

        function loadChatHistory() {
            try {
                const saved = localStorage.getItem('aiChatHistory');
                if (saved) {
                    messageHistory = JSON.parse(saved);
                    if (messageHistory.length > 0) {
                        hideWelcomeMessage();
                        messageHistory.forEach(msg => {
                            addMessageToUI(msg.content, msg.sender);
                        });
                    }
                }
            } catch (error) {
                console.error('Error loading chat history:', error);
                messageHistory = [];
            }
        }

        function addMessageToUI(content, sender) {
            const messagesContainer = document.getElementById('messagesContainer');
            const messageDiv = document.createElement('div');
            messageDiv.className = 'message';
            
            if (sender === 'user') {
                messageDiv.innerHTML = `
                    <div class="user-message">
                        ${content}
                    </div>
                `;
            } else {
                messageDiv.innerHTML = `
                    <div class="flex items-start space-x-2 space-x-reverse">
                        <div class="ai-avatar" style="width: 32px; height: 32px; font-size: 14px; margin-top: 4px;">
                            <i class="fas fa-robot"></i>
                        </div>
                        <div class="ai-message flex-1">
                            ${content}
                        </div>
                    </div>
                `;
            }
            
            messagesContainer.appendChild(messageDiv);
        }

        console.log('✅ AI Assistant loaded successfully');
    </script>
</body>
</html>
